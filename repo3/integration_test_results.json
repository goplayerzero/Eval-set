{
  "Repo": {
    "remoteUrl": "https://github.com/hacs/integration.git",
    "languages": ["py"]
  },
  "IntegrationTest": {
    "fileContent": "import sys\nfrom unittest.mock import MagicMock, patch\n\nfrom homeassistant.components.websocket_api import DOMAIN as WEBSOCKET_DOMAIN\nfrom homeassistant.core import HomeAssistant\nimport pytest\n\nfrom custom_components.hacs.base import HacsBase\n\nfrom tests.common import create_config_entry, get_hacs\nfrom tests.conftest import SnapshotFixture\n\n\nasync def test_integration_setup(\n    hass: HomeAssistant,\n    snapshots: SnapshotFixture,\n):\n    config_entry = create_config_entry()\n    hass.data.pop(\"custom_components\", None)\n    config_entry.add_to_hass(hass)\n    assert await hass.config_entries.async_setup(config_entry.entry_id)\n    await hass.async_block_till_done()\n\n    hacs: HacsBase = get_hacs(hass)\n    assert not hacs.system.disabled\n    assert hacs.stage == \"running\"\n\n    await snapshots.assert_hacs_data(\n        hacs,\n        \"test_integration_setup.json\",\n        {\n            \"websocket_commands\": [\n                command for command in hass.data[WEBSOCKET_DOMAIN] if command.startswith(\"hacs/\")\n            ],\n        },\n    )\n\n\nasync def test_integration_setup_with_custom_updater(\n    hass: HomeAssistant,\n    snapshots: SnapshotFixture,\n    caplog: pytest.LogCaptureFixture,\n):\n    config_entry = create_config_entry()\n    hass.data.pop(\"custom_components\", None)\n    config_entry.add_to_hass(hass)\n    with patch.dict(\n        sys.modules,\n        {\n            **sys.modules,\n            # Pretend custom_updater is loaded\n            \"custom_components.custom_updater\": MagicMock(),\n        },\n    ):\n        assert not await hass.config_entries.async_setup(config_entry.entry_id)\n        await hass.async_block_till_done()\n\n    hacs: HacsBase = get_hacs(hass)\n    assert hacs.system.disabled_reason == \"constrains\"\n\n    assert (\n        \"HACS cannot be used with custom_updater. To use HACS you need to remove custom_updater from `custom_components`\"\n        in caplog.text\n    )\n\n    await snapshots.assert_hacs_data(\n        hacs,\n        \"test_integration_setup_with_custom_updater.json\",\n        {},\n    )\n"
  },
  "IntegrationTestRun": {
    "id": "run-003",
    "commitId": "e04d8c8fcce81d3e9e1abd4c47ccc1eaf1bac9f7",
    "result": {
      "stdout": "tests/integration/test_integration_setup.py::test_integration_setup PASSED                                                                                               [ 50%]\n-------------------------------------------- live log teardown ---------------------------------------------\n2019-02-26 07:02:39.000 DEBUG    MainThread custom_components.hacs:data.py:76 <HacsData async_write> Saving data\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.helpers.storage:storage.py:159 hacs.hacs: Cache miss\n2019-02-26 07:02:39.000 DEBUG    SyncWorker_0 homeassistant.helpers.storage:storage.py:554 Writing data for hacs.hacs to /private/var/folders/k0/btb1624n5235gzljgdym1wrh0000gn/T/pytest-of-aadityasubedi/pytest-4/test_integration_setup0/.storage/hacs.hacs\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.helpers.storage:storage.py:159 hacs.data: Cache miss\n2019-02-26 07:02:39.000 DEBUG    MainThread custom_components.hacs:store.py:69 <HACSStore async_save_to_store> Did not store data for 'hacs.data'. Content did not change\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.helpers.storage:storage.py:159 hacs.repositories: Cache miss\n2019-02-26 07:02:39.000 DEBUG    MainThread custom_components.hacs:store.py:69 <HACSStore async_save_to_store> Did not store data for 'hacs.repositories'. Content did not change\n2019-02-26 07:02:39.000 INFO     MainThread custom_components.hacs:__init__.py:210 Removing sidepanel\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event panels_updated[L]>\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event state_changed[L]: entity_id=update.hacs_update, old_state=<state update.hacs_update=on; auto_update=False, display_precision=0, installed_version=0.0.0, in_progress=False, latest_version=, release_summary=None, release_url=https://github.com/hacs/integration/releases/, skipped_version=None, title=None, update_percentage=None, entity_picture=https://brands.home-assistant.io/_/hacs/icon.png, friendly_name=HACS update, supported_features=23 @ 2019-02-26T07:02:39-08:00>, new_state=<state update.hacs_update=unavailable; restored=True, friendly_name=HACS update, supported_features=23 @ 2019-02-26T07:02:39-08:00>>\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event homeassistant_stop[L]>\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event homeassistant_final_write[L]>\n2019-02-26 07:02:39.000 DEBUG    SyncWorker_0 homeassistant.helpers.storage:storage.py:554 Writing data for http to /private/var/folders/k0/btb1624n5235gzljgdym1wrh0000gn/T/pytest-of-aadityasubedi/pytest-4/test_integration_setup0/.storage/http\n2019-02-26 07:02:39.000 DEBUG    SyncWorker_1 homeassistant.helpers.storage:storage.py:554 Writing data for auth to /private/var/folders/k0/btb1624n5235gzljgdym1wrh0000gn/T/pytest-of-aadityasubedi/pytest-4/test_integration_setup0/.storage/auth\n2019-02-26 07:02:39.000 DEBUG    SyncWorker_2 homeassistant.helpers.storage:storage.py:554 Writing data for core.device_registry to /private/var/folders/k0/btb1624n5235gzljgdym1wrh0000gn/T/pytest-of-aadityasubedi/pytest-4/test_integration_setup0/.storage/core.device_registry\n2019-02-26 07:02:39.000 DEBUG    SyncWorker_3 homeassistant.helpers.storage:storage.py:554 Writing data for core.entity_registry to /private/var/folders/k0/btb1624n5235gzljgdym1wrh0000gn/T/pytest-of-aadityasubedi/pytest-4/test_integration_setup0/.storage/core.entity_registry\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event homeassistant_close[L]>\n2025-06-12 13:40:35.126 DEBUG    MainThread asyncio:selector_events.py:64 Using selector: KqueueSelector\n\ntests/integration/test_integration_setup.py::test_integration_setup_with_custom_updater PASSED                                                                                               [100%]\n-------------------------------------------- live log teardown ---------------------------------------------\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event homeassistant_stop[L]>\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event homeassistant_final_write[L]>\n2019-02-26 07:02:39.000 DEBUG    SyncWorker_0 homeassistant.helpers.storage:storage.py:554 Writing data for auth to /private/var/folders/k0/btb1624n5235gzljgdym1wrh0000gn/T/pytest-of-aadityasubedi/pytest-4/test_integration_setup_with_cu0/.storage/auth\n2019-02-26 07:02:39.000 DEBUG    SyncWorker_1 homeassistant.helpers.storage:storage.py:554 Writing data for http to /private/var/folders/k0/btb1624n5235gzljgdym1wrh0000gn/T/pytest-of-aadityasubedi/pytest-4/test_integration_setup_with_cu0/.storage/http\n2019-02-26 07:02:39.000 DEBUG    MainThread homeassistant.core:core.py:1547 Bus:Handling <Event homeassistant_close[L]>\n2025-06-12 13:40:35.215 DEBUG    MainThread asyncio:selector_events.py:64 Using selector: KqueueSelector\n\n\n============================================== tests coverage ==============================================\n_____________________________ coverage: platform darwin, python 3.13.0-final-0 _____________________________\n\nCoverage XML written to file coverage.xml\n============================================ 2 passed in 0.47s =============================================",
      "stderr": "",
      "returnCode": 0,
      "pass": true
    }
  }
} 